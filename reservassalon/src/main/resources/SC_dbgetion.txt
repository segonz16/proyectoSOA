
-- Creación de la tabla de Profesores
CREATE TABLE profesores (
    documento_id VARCHAR(20) PRIMARY KEY,
    tipo_documento VARCHAR(20) NOT NULL,
    nombre VARCHAR(100) NOT NULL,
    email VARCHAR(100) UNIQUE NOT NULL,
    telefono VARCHAR(15),
    fecha_creacion TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- Creación de la tabla de Salones
CREATE TABLE salones (
    codigo_salon VARCHAR(10) PRIMARY KEY,
    nombre VARCHAR(50) NOT NULL,
    ubicacion VARCHAR(100),
    capacidad INT CHECK (capacidad > 0),
    descripcion TEXT,
    fecha_creacion TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- Creación de la tabla de Reservas
CREATE TABLE reservas (
    id SERIAL PRIMARY KEY,
    documento_id_profesor VARCHAR(20) NOT NULL,
    codigo_salon VARCHAR(10) NOT NULL,
    fecha_reserva DATE NOT NULL,
    hora_inicio TIME NOT NULL,
    hora_fin TIME NOT NULL,
    fecha_creacion TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    CONSTRAINT fk_profesor FOREIGN KEY (documento_id_profesor) REFERENCES profesores (documento_id) ON DELETE CASCADE,
    CONSTRAINT fk_salon FOREIGN KEY (codigo_salon) REFERENCES salones (codigo_salon) ON DELETE CASCADE,
    CONSTRAINT chk_hora CHECK (hora_fin > hora_inicio)
);

-- Restricción de unicidad para evitar reservas duplicadas en el mismo salón y horario
CREATE UNIQUE INDEX idx_unica_reserva ON reservas (codigo_salon, fecha_reserva, hora_inicio, hora_fin);

-- Ejemplo de inserciones
INSERT INTO profesores (documento_id, tipo_documento, nombre, email, telefono) VALUES 
('123456789', 'cc', 'Juan Pérez', 'juan.perez@poli.edu.com', '555-1234'),
('987654321', 'cc', 'Ana Gómez', 'ana.gomez@poli.edu.com', '555-5678');

INSERT INTO salones (codigo_salon, nombre, ubicacion, capacidad, descripcion) VALUES 
('P13-201', 'Salón de informatica', 'medellin, Piso 2', 30, 'Salón para clases teóricas'),
('P13-301', 'Salón de informatica', 'medellin, Piso 3', 20, 'Laboratorio con equipos de computo');

-- Ejemplo de reserva
INSERT INTO reservas (documento_id_profesor, codigo_salon, fecha_reserva, hora_inicio, hora_fin) VALUES 
('123456789', 'P13-201', '2024-11-10', '10:00', '12:00'),
('987654321', 'P13-301', '2024-11-11', '14:00', '16:00');

-- Ejemplo de reserva
INSERT INTO reservas (documento_id_profesor, codigo_salon, fecha_reserva, hora_inicio, hora_fin) VALUES 
('123456789', 'P13-201', '2024-11-10', '10:00', '12:00');
